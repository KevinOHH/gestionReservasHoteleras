<div class="huesped-container">

  <ng-container *ngIf="vista === 'lista'">

    <div class="page-header">
      <div class="header-left">
        <div class="header-icon"></div>
        <div>
          <h1 class="page-title">Hu√©spedes</h1>
          <p class="page-subtitle">Gesti√≥n de hu√©spedes registrados</p>
        </div>
      </div>
      <div class="header-actions">
        <button class="btn btn-secondary" (click)="irABusqueda()">
          Buscar por ID
        </button>
        <button class="btn btn-primary" (click)="irANuevo()">
          <span class="btn-icon-text">+</span> Nuevo Hu√©sped
        </button>
      </div>
    </div>

    <div class="alert alert-error search-error" *ngIf="busquedaError">{{ busquedaError }}</div>

    <div class="loading-wrap" *ngIf="loading">
      <div class="spinner"></div>
      <span>Cargando hu√©spedes...</span>
    </div>

    <div class="table-card" *ngIf="!loading">
      <div class="table-meta">
        <span class="table-count">{{ huespedes.length }} registros</span>
      </div>
      <div class="table-wrapper">
        <table class="h-table">
          <thead>
            <tr>
              <th>ID</th>
              <th>Nombre</th>
              <th>Email</th>
              <th>Tel√©fono</th>
              <th>Documento</th>
              <th>Nacionalidad</th>
              <th>Estado</th>
              <th>Acciones</th>
            </tr>
          </thead>
          <tbody>
            <tr *ngFor="let h of huespedes"
                [class.row-eliminado]="h.estadoRegistro === 'ELIMINADO'">
              <td class="td-id">#{{ h.id }}</td>
              <td class="td-nombre">{{ h.nombre }} {{ h.apellido }}</td>
              <td>{{ h.email }}</td>
              <td>{{ h.telefono }}</td>
              <td>{{ h.tipoDocumento }}</td>
              <td>{{ h.nacionalidad }}</td>
              <td>
                <span class="badge"
                      [class.badge-activo]="h.estadoRegistro === 'ACTIVO'"
                      [class.badge-eliminado]="h.estadoRegistro === 'ELIMINADO'">
                  {{ h.estadoRegistro }}
                </span>
              </td>
              <td class="td-actions">
                <button class="act-btn act-edit" title="Editar"
                        *ngIf="isAdmin() && h.estadoRegistro === 'ACTIVO'"
                        (click)="irAEditar(h)">ED</button>
                <button class="act-btn act-delete" title="Eliminar"
                        *ngIf="isAdmin() && h.estadoRegistro === 'ACTIVO'"
                        (click)="eliminar(h)">EL</button>
              </td>
            </tr>
            <tr *ngIf="huespedes.length === 0">
              <td colspan="7" class="empty-row">No hay hu√©spedes registrados.</td>
            </tr>
          </tbody>
        </table>
      </div>
    </div>

  </ng-container>

  <ng-container *ngIf="vista === 'formulario'">

    <div class="page-header">
      <button class="btn-back" (click)="irALista()">‚Üê Volver</button>
      <div>
        <h1 class="page-title">{{ isEditing ? 'Editar Hu√©sped' : 'Nuevo Hu√©sped' }}</h1>
        <p class="page-subtitle">
          {{ isEditing ? 'Modifique los datos del hu√©sped' : 'Complete los campos para registrar' }}
        </p>
      </div>
    </div>

   <div class="alert alert-error search-error" *ngIf="busquedaError">{{ busquedaError }}</div>

    <div class="form-card">
      <form [formGroup]="form" (ngSubmit)="onSubmit()" novalidate>

        <div class="form-grid">

          <div class="form-group">
            <label class="form-label" for="nombre">Nombre <span class="req">*</span></label>
            <input id="nombre" type="text" class="form-control"
                   [class.is-invalid]="isInvalid('nombre')"
                   formControlName="nombre" placeholder="Ej. Juan">
            <div class="invalid-feedback" *ngIf="isInvalid('nombre')">
              <ng-container *ngIf="form.get('nombre')?.hasError('required')">Obligatorio.</ng-container>
              <ng-container *ngIf="form.get('nombre')?.hasError('minlength')">M√≠nimo 2 caracteres.</ng-container>
              <ng-container *ngIf="form.get('nombre')?.hasError('maxlength')">M√°ximo 50 caracteres.</ng-container>
            </div>
          </div>

          <div class="form-group">
            <label class="form-label" for="apellido">Apellido <span class="req">*</span></label>
            <input id="apellido" type="text" class="form-control"
                   [class.is-invalid]="isInvalid('apellido')"
                   formControlName="apellido" placeholder="Ej. P√©rez">
            <div class="invalid-feedback" *ngIf="isInvalid('apellido')">
              <ng-container *ngIf="form.get('apellido')?.hasError('required')">Obligatorio.</ng-container>
              <ng-container *ngIf="form.get('apellido')?.hasError('minlength')">M√≠nimo 2 caracteres.</ng-container>
              <ng-container *ngIf="form.get('apellido')?.hasError('maxlength')">M√°ximo 50 caracteres.</ng-container>
            </div>
          </div>

          <div class="form-group form-full">
            <label class="form-label" for="email">Email <span class="req">*</span></label>
            <input id="email" type="email" class="form-control"
                   [class.is-invalid]="isInvalid('email')"
                   formControlName="email" placeholder="correo@ejemplo.com">
            <div class="invalid-feedback" *ngIf="isInvalid('email')">
              <ng-container *ngIf="form.get('email')?.hasError('required')">Obligatorio.</ng-container>
              <ng-container *ngIf="form.get('email')?.hasError('email')">Formato inv√°lido.</ng-container>
            </div>
          </div>

          <div class="form-group">
            <label class="form-label" for="telefono">Tel√©fono <span class="req">*</span></label>
            <input id="telefono" type="text" class="form-control"
                   [class.is-invalid]="isInvalid('telefono')"
                   formControlName="telefono" placeholder="10 d√≠gitos" maxlength="10">
            <div class="invalid-feedback" *ngIf="isInvalid('telefono')">
              <ng-container *ngIf="form.get('telefono')?.hasError('required')">Obligatorio.</ng-container>
              <ng-container *ngIf="form.get('telefono')?.hasError('pattern')">Exactamente 10 d√≠gitos.</ng-container>
            </div>
          </div>

          <div class="form-group">
            <label class="form-label" for="tipoDocumento">Tipo de Documento <span class="req">*</span></label>
            <select id="tipoDocumento" class="form-control"
                    [class.is-invalid]="isInvalid('tipoDocumento')"
                    formControlName="tipoDocumento">
              <option value="">-- Seleccione --</option>
              <option *ngFor="let tipo of tiposDocumento" [value]="tipo">{{ tipo }}</option>
            </select>
            <div class="invalid-feedback" *ngIf="isInvalid('tipoDocumento')">Obligatorio.</div>
          </div>

          <div class="form-group form-full">
            <label class="form-label" for="nacionalidad">Nacionalidad <span class="req">*</span></label>
            <select id="nacionalidad" class="form-control"
                    [class.is-invalid]="isInvalid('nacionalidad')"
                    formControlName="nacionalidad">
              <option value="">-- Seleccione --</option>
              <option *ngFor="let nac of nacionalidades" [value]="nac.value">{{ nac.label }}</option>
            </select>
            <div class="invalid-feedback" *ngIf="isInvalid('nacionalidad')">Obligatorio.</div>
          </div>

        </div>

        <div class="form-actions">
          <button type="button" class="btn btn-secondary"
                  (click)="irALista()" [disabled]="submitting">Cancelar</button>
          <button type="submit" class="btn btn-primary" [disabled]="submitting">
            <span class="spinner-sm" *ngIf="submitting"></span>
            {{ submitting ? 'Guardando...' : (isEditing ? 'Actualizar' : 'Registrar') }}
          </button>
        </div>

      </form>
    </div>

  </ng-container>

  <ng-container *ngIf="vista === 'busqueda'">

    <div class="page-header">
      <button class="btn-back" (click)="irALista()">Volver</button>
      <div>
        <h1 class="page-title">Buscar Hu√©sped por ID</h1>
        <p class="page-subtitle">Consulta cualquier hu√©sped (activo o eliminado) por su ID</p>
      </div>
    </div>

    <div class="alert alert-error search-error" *ngIf="busquedaError">{{ busquedaError }}</div>

    <!-- Barra de b√∫squeda -->
    <div class="form-card search-card">
      <div class="search-bar">
        <input
          type="number"
          class="form-control search-input"
          placeholder="Ingrese el ID del hu√©sped (ej. 25)"
          [(ngModel)]="busquedaId"
          [ngModelOptions]="{standalone: true}"
          (keyup.enter)="buscarPorId()"
          min="1">
        <button class="btn btn-primary" (click)="buscarPorId()" [disabled]="buscando">
          <span class="spinner-sm" *ngIf="buscando"></span>
          {{ buscando ? 'Buscando...' : 'Buscar' }}
        </button>
        <button class="btn btn-secondary" (click)="limpiarBusqueda()" *ngIf="busquedaResultado || busquedaError">
          Limpiar
        </button>
      </div>
      <div class="alert alert-error search-error" *ngIf="busquedaError">{{ busquedaError }}</div>
    </div>

    <div class="detail-card" *ngIf="busquedaResultado">

      <div class="detail-hero">
        <div class="avatar">{{ iniciales(busquedaResultado) }}</div>
        <div class="hero-info">
          <h2>{{ busquedaResultado.nombre }} {{ busquedaResultado.apellido }}</h2>
          <span class="badge"
                [class.badge-activo]="busquedaResultado.estadoRegistro === 'ACTIVO'"
                [class.badge-eliminado]="busquedaResultado.estadoRegistro === 'ELIMINADO'">
            {{ busquedaResultado.estadoRegistro }}
          </span>
        </div>
      </div>

      <div class="detail-grid">
        <div class="detail-item">
          <span class="detail-label">ID</span>
          <span class="detail-value">#{{ busquedaResultado.id }}</span>
        </div>
        <div class="detail-item">
          <span class="detail-label">Email</span>
          <span class="detail-value">{{ busquedaResultado.email }}</span>
        </div>
        <div class="detail-item">
          <span class="detail-label">Tel√©fono</span>
          <span class="detail-value">{{ busquedaResultado.telefono }}</span>
        </div>
        <div class="detail-item">
          <span class="detail-label">Tipo de Documento</span>
          <span class="detail-value">{{ busquedaResultado.tipoDocumento }}</span>
        </div>
        <div class="detail-item">
          <span class="detail-label">Nacionalidad</span>
          <span class="detail-value">{{ busquedaResultado.nacionalidad }}</span>
        </div>
      </div>

     <div class="detail-actions" *ngIf="busquedaResultado.estadoRegistro === 'ACTIVO'">
         <button class="btn btn-primary" (click)="irAEditar(busquedaResultado)">‚úèÔ∏è Editar</button>
         <button class="btn btn-danger" *ngIf="isAdmin()"
        (click)="eliminar(busquedaResultado)">üóëÔ∏è Eliminar</button>
     </div>

      <div class="badge-eliminado-info" *ngIf="busquedaResultado.estadoRegistro === 'ELIMINADO'">
         Este hu√©sped est√° eliminado. No se pueden realizar acciones sobre √©l.
      </div>

    </div>

  </ng-container>

</div>